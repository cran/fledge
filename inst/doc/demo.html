<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Using fledge</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using fledge</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This guide will demonstrate how to use {fledge}, using a mock R
package as an example. We are going to call our package “{tea}”. We will
develop it from scratch and also maintain a changelog as the development
progresses. Finally, we will demonstrate how this changelog can
eventually be converted to release notes when the package is submitted
to CRAN.</p>
<div class="alert alert-info">
<p>We are typing this demo as an R Markdown vignette therefore we will
be using R tools for creating files, editing them, and interacting with
git: in real life you can be using e.g. an IDE or the command line. The
fledge package won’t care!</p>
</div>
</div>
<div id="set-up-the-development-environment" class="section level2">
<h2>Set up the development environment</h2>
<p>Before we start development for {tea}, we set up the basic
development environment required for any typical R package.</p>
<div id="create-a-package" class="section level3">
<h3>Create a package</h3>
<p>We will start by creating a new package. For this demo, the package
is created in a temporary directory. A real project will live somewhere
in your home directory.</p>
<p>The <code>usethis::create_package()</code> function sets up a package
project ready for development.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>pkg <span class="ot">&lt;-</span> usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="st">&quot;tea&quot;</span>)</span></code></pre></div>
<p>In an interactive RStudio session, a new window opens and you would
work there. Users of other environments would change the working
directory manually. For this demo, we manually set the active
project.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">proj_set</span>()</span></code></pre></div>
<p>The infrastructure files and directories that comprise a minimal R
package are created:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_ls</span>()</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="do">## DESCRIPTION NAMESPACE   R           tea.Rproj</span></span></code></pre></div>
</div>
<div id="create-and-configure-a-git-repository" class="section level3">
<h3>Create and configure a Git repository</h3>
<p>Next, one would set up this package for development and create a Git
repository for the package. We achieved this with gert code.</p>
<p>You could use <code>usethis::use_git()</code> function that creates
an initial commit, and the repository is in a clean state.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Number of commits until now</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">nrow</span>(gert<span class="sc">::</span><span class="fu">git_log</span>())</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># Anything staged?</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_status</span>()</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="do">## # A tibble: 0 × 3</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="do">## # ℹ 3 variables: file &lt;chr&gt;, status &lt;chr&gt;, staged &lt;lgl&gt;</span></span></code></pre></div>
<p>For working in branches, it is recommended to turn off fast-forward
merging:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_config_set</span>(<span class="st">&quot;merge.ff&quot;</span>, <span class="st">&quot;false&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># gert::git_config_global_set(&quot;merge.ff&quot;, &quot;false&quot;) # to set globally</span></span></code></pre></div>
<p>An alternative is to use squash commits.</p>
<p>We also set up a git remote. In real life you might be using a
function like <code>usethis::use_github()</code>. We set up a local
remote using a git repo we secretly created earlier.</p>
<p>We create two functions to show the contents and tags of the remote.
In real life, you’d probably simply browse the GitHub interface for
instance!</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>show_files <span class="ot">&lt;-</span> <span class="cf">function</span>(remote_url) {</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  tempdir_remote <span class="ot">&lt;-</span> withr<span class="sc">::</span><span class="fu">local_tempdir</span>(<span class="at">pattern =</span> <span class="st">&quot;remote&quot;</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  withr<span class="sc">::</span><span class="fu">with_dir</span>(tempdir_remote, {</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    repo <span class="ot">&lt;-</span> gert<span class="sc">::</span><span class="fu">git_clone</span>(remote_url)  </span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="fu">suppressMessages</span>(gert<span class="sc">::</span><span class="fu">git_branch_checkout</span>(<span class="st">&quot;main&quot;</span>, <span class="at">force =</span> <span class="cn">TRUE</span>, <span class="at">repo =</span> <span class="st">&quot;remote&quot;</span>))</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    fs<span class="sc">::</span><span class="fu">dir_ls</span>(<span class="st">&quot;remote&quot;</span>, <span class="at">recurse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  })</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>}</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="fu">show_files</span>(remote_url)</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="do">## remote/DESCRIPTION remote/NAMESPACE   remote/tea.Rproj</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>show_tags <span class="ot">&lt;-</span> <span class="cf">function</span>(remote_url) {</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>  tempdir_remote <span class="ot">&lt;-</span> withr<span class="sc">::</span><span class="fu">local_tempdir</span>(<span class="at">pattern =</span> <span class="st">&quot;remote&quot;</span>)</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>  withr<span class="sc">::</span><span class="fu">with_dir</span>(tempdir_remote, {</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    gert<span class="sc">::</span><span class="fu">git_clone</span>(remote_url)  </span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>    <span class="co"># Only show name and ref</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>    gert<span class="sc">::</span><span class="fu">git_tag_list</span>(<span class="at">repo =</span> <span class="st">&quot;remote&quot;</span>)[, <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;ref&quot;</span>)]</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>  })</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="create-initial-news.md-file" class="section level3">
<h3>Create initial NEWS.md file</h3>
<p>An initial NEWS file can be created with
<code>usethis::use_news_md()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_news_md</span>()</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="do">## ✔ Writing &#39;NEWS.md&#39;</span></span></code></pre></div>
<p>Let’s take a look at the contents:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>news <span class="ot">&lt;-</span> <span class="fu">readLines</span>(usethis<span class="sc">::</span><span class="fu">proj_path</span>(<span class="st">&quot;NEWS.md&quot;</span>))</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">cat</span>(news, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="do">## # tea (development version)</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="do">## * Added a `NEWS.md` file to track changes to the package.</span></span></code></pre></div>
<p>This file needs to be tracked by Git:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_add</span>(<span class="st">&quot;NEWS.md&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_commit</span>(<span class="st">&quot;Initial NEWS.md .&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_push</span>(<span class="at">remote =</span> <span class="st">&quot;origin&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">show_files</span>(remote_url)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="do">## remote/DESCRIPTION remote/NAMESPACE   remote/NEWS.md     remote/tea.Rproj</span></span></code></pre></div>
<div class="alert alert-info">
<p>Note that we have done nothing fledge specific yet.</p>
</div>
</div>
</div>
<div id="the-development-phase" class="section level2">
<h2>The development phase</h2>
<div id="create-an-r-file" class="section level3">
<h3>Create an R file</h3>
<p>Now we start coding in the functionality for the package. We start by
creating the new R file called <code>cup.R</code> and adding code (well
only a comment).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">&quot;cup&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="do">## • Edit &#39;R/cup.R&#39;</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">&quot;# cup&quot;</span>, <span class="st">&quot;R/cup.R&quot;</span>)</span></code></pre></div>
<p>We commit this file to Git with a relevant message.</p>
<div class="alert alert-info">
<p>That is our first fledge specific step! Note the <strong>use of the
bullet (-) at the beginning of the commit message</strong>. This
indicates that the message should be included in <code>NEWS.md</code>
when it is updated.</p>
</div>
<p>It does not matter how and where you type the commit message (gert in
R, RStudio Git window, command line, VSCode, etc.). What’s important is
the content of the commit message.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_add</span>(<span class="st">&quot;R/cup.R&quot;</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_commit</span>(<span class="st">&quot;- New cup_of_tea() function makes it easy to drink a cup of tee.&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_push</span>()</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">show_files</span>(remote_url)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="do">## remote/DESCRIPTION remote/NAMESPACE   remote/NEWS.md     remote/R           </span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="do">## remote/R/cup.R     remote/tea.Rproj</span></span></code></pre></div>
</div>
<div id="create-a-test" class="section level3">
<h3>Create a test</h3>
<p>The code in <code>cup.R</code> warrants a test (at least it would if
it were actual code!):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">&quot;cup&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="do">## ✔ Adding &#39;testthat&#39; to Suggests field in DESCRIPTION</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="do">## ✔ Adding &#39;3&#39; to Config/testthat/edition</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="do">## ✔ Creating &#39;tests/testthat/&#39;</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="do">## ✔ Writing &#39;tests/testthat.R&#39;</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="do">## ✔ Writing &#39;tests/testthat/test-cup.R&#39;</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="do">## • Edit &#39;tests/testthat/test-cup.R&#39;</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(<span class="st">&quot;tests/testthat/test-cup.R&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="do">## test_that(&quot;multiplication works&quot;, {</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="do">##   expect_equal(2 * 2, 4)</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="do">## })</span></span></code></pre></div>
<p>In a real project we would substitute the testing code from the
template by real tests. In this demo we commit straight away,
<strong>again with a bulleted message</strong>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_add</span>(<span class="st">&quot;DESCRIPTION&quot;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_add</span>(<span class="st">&quot;tests/testthat.R&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_add</span>(<span class="st">&quot;tests/testthat/test-cup.R&quot;</span>)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_commit</span>(<span class="st">&quot;- Add tests for cup of tea.&quot;</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_push</span>()</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">show_files</span>(remote_url)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="do">## remote/DESCRIPTION               remote/NAMESPACE                 </span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="do">## remote/NEWS.md                   remote/R                         </span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="do">## remote/R/cup.R                   remote/tea.Rproj                 </span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="do">## remote/tests                     remote/tests/testthat            </span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="do">## remote/tests/testthat/test-cup.R remote/tests/testthat.R</span></span></code></pre></div>
</div>
<div id="update-news.md" class="section level3">
<h3>Update NEWS.md</h3>
<p>Let us look at the commit history until now. You might use any Git
tool you want to consult it, we use gert.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Only show number of files, messages</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(gert<span class="sc">::</span><span class="fu">git_log</span>()[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)])</span></code></pre></div>
<table>
<colgroup>
<col width="7%" />
<col width="7%" />
<col width="84%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">files</th>
<th align="left">merge</th>
<th align="left">message</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="left">FALSE</td>
<td align="left">- Add tests for cup of tea.</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="left">- New cup_of_tea() function makes it easy to drink a
cup of tee.</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="left">Initial NEWS.md .</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="left">FALSE</td>
<td align="left">First commit</td>
</tr>
</tbody>
</table>
<p>We have two “bulletted” messages which for fledge means two
NEWS-worthy messages.</p>
<p>Let us update <code>NEWS.md</code>!</p>
<p>We use <code>fledge::bump_version()</code> to assign a new dev
version number to the package and also update <code>NEWS.md</code>.</p>
<p>The current version number of our package is 0.0.0.9000.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>fledge<span class="sc">::</span><span class="fu">bump_version</span>()</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="do">## → Scraping 4 commit messages.</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="do">## ✔ Found 2 NEWS-worthy entries.</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="do">## ── Updating NEWS ──</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="do">## → Adding new entries to &#39;NEWS.md&#39;.</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="do">## ── Update Version ──</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="do">## ✔ Package version bumped to 0.0.0.9001.</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="do">## → Adding header to &#39;NEWS.md&#39;.</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="do">## → Committing changes.</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="do">## ── Tagging Version ──</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="do">## → Creating tag v0.0.0.9001 with tag message derived from &#39;NEWS.md&#39;.</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="do">## • Edit &#39;NEWS.md&#39;</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="do">## ! Call `fledge::finalize_version(push = TRUE)`.</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="do">## NULL</span></span></code></pre></div>
<p>The new version number is 0.0.0.9001.</p>
<div class="alert alert-info">
<p>If you run <code>fledge::bump_version()</code> too early by mistake
(e.g. you wanted to do one more code edit), you can run
<code>fledge::unbump_version()</code>! This should happen immediately
after bumping. If you have pushed or edited code in the meantime, it’s
too late – just continue and assign a new version when you are done with
the edits.</p>
</div>
</div>
<div id="review-news.md" class="section level3">
<h3>Review NEWS.md</h3>
<p>Let us see what <code>NEWS.md</code> looks like after that bump.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>news <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;NEWS.md&quot;</span>)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">cat</span>(news, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="do">## &lt;!-- NEWS.md is maintained by https://cynkra.github.io/fledge, do not edit --&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="do">## # tea 0.0.0.9001 (2024-02-18)</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="do">## - Add tests for cup of tea.</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="do">## - New cup_of_tea() function makes it easy to drink a cup of tee.</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="do">## # tea (development version)</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="do">## * Added a `NEWS.md` file to track changes to the package.</span></span></code></pre></div>
<p>While reviewing we notice that there was a typo in one of the
comments (congrats if you noticed right away that we typed “tee” instead
of “tea”!).</p>
<div class="alert alert-warning">
<p>The fledge package adds a comment about not editing
<code>NEWS.md</code> by hand to <code>NEWS.md</code> but actually you
can… if you do it right! Read on.</p>
</div>
<p>Let’s fix the typo, which you’d do by hand.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>news <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;tee&quot;</span>, <span class="st">&quot;tea&quot;</span>, news)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="fu">cat</span>(news, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="do">## &lt;!-- NEWS.md is maintained by https://cynkra.github.io/fledge, do not edit --&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="do">## # tea 0.0.0.9001 (2024-02-18)</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="do">## - Add tests for cup of tea.</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="do">## - New cup_of_tea() function makes it easy to drink a cup of tea.</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="do">## # tea (development version)</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="do">## * Added a `NEWS.md` file to track changes to the package.</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="fu">writeLines</span>(news, <span class="st">&quot;NEWS.md&quot;</span>)</span></code></pre></div>
<p>This does not affect the original commit message, only
<code>NEWS.md</code>. (<a href="https://docs.github.com/en/github/committing-changes-to-your-project/creating-and-editing-commits/changing-a-commit-message#amending-older-or-multiple-commit-messages">Editing
commit messages</a> is not something fledge supports).</p>
</div>
<div id="finalize-version" class="section level3">
<h3>Finalize version</h3>
<div class="alert alert-warning">
<p>After tweaking <code>NEWS.md</code>, it is important to use
<code>fledge::finalize_version()</code> and not to commit manually.</p>
</div>
<p>Using <code>fledge::finalize_version()</code> instead of committing
manually ensures that the tag is set to the correct version in spite of
the <code>NEWS.md</code> update. It should be called when
<code>NEWS.md</code> is manually updated. Note that it should be called
after <code>fledge::bump_version()</code>, an error is raised if another
commit has been added after that.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">show_tags</span>(remote_url)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="do">## # A tibble: 0 × 2</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="do">## # ℹ 2 variables: name &lt;chr&gt;, ref &lt;chr&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>fledge<span class="sc">::</span><span class="fu">finalize_version</span>(<span class="at">push =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="do">## → Resetting to previous commit.</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="do">## → Committing changes.</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="do">## ── Tagging Version ──</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="do">## → Deleting existing tag v0.0.0.9001.</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="do">## → Creating tag v0.0.0.9001 with tag message derived from &#39;NEWS.md&#39;.</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="do">## → Force-pushing tag v0.0.0.9001.</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="do">## → Pushing main.</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="fu">show_tags</span>(remote_url)</span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="do">## # A tibble: 1 × 2</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="do">##   name        ref                  </span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="do">##   &lt;chr&gt;       &lt;chr&gt;                </span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a><span class="do">## 1 v0.0.0.9001 refs/tags/v0.0.0.9001</span></span></code></pre></div>
<p>Let’s look at NEWS.md now:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>news <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;NEWS.md&quot;</span>)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">cat</span>(news, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="do">## &lt;!-- NEWS.md is maintained by https://cynkra.github.io/fledge, do not edit --&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="do">## # tea 0.0.0.9001 (2024-02-18)</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="do">## - Add tests for cup of tea.</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a><span class="do">## - New cup_of_tea() function makes it easy to drink a cup of tea.</span></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="do">## # tea (development version)</span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a><span class="do">## * Added a `NEWS.md` file to track changes to the package.</span></span></code></pre></div>
<p>The version of the package is 0.0.0.9001.</p>
<p>A tag has been created for the version which is good practice, and
crucial when using fledge: for updating the changelog, fledge looks
through all commit messages <strong>since the latest tag</strong>.</p>
</div>
<div id="change-code-and-commit" class="section level3">
<h3>Change code and commit</h3>
<p>{tea} with cup is tested, now we want to enhance with bowl. This
requires changes to the code, and perhaps a new test. We create a branch
(whose name starts with a “f” for “feature”) and switch to this branch
to implement this.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_branch_create</span>(<span class="st">&quot;f-bowl&quot;</span>, <span class="at">checkout =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>On the branch, separate commits are used for the tests and the
implementation. These commit messages do not need to be formatted
specially, because {fledge} will ignore them anyway.</p>
<p>This time we write the tests first, test-driven development.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">&quot;bowl&quot;</span>)</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="do">## ✔ Writing &#39;tests/testthat/test-bowl.R&#39;</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="do">## • Edit &#39;tests/testthat/test-bowl.R&#39;</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_add</span>(<span class="st">&quot;tests/testthat/test-bowl.R&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_commit</span>(<span class="st">&quot;Add bowl tests.&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">&quot;bowl&quot;</span>)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="do">## • Edit &#39;R/bowl.R&#39;</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">&quot;# bowl of tea&quot;</span>, <span class="st">&quot;R/bowl.R&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_add</span>(<span class="st">&quot;R/bowl.R&quot;</span>)</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_commit</span>(<span class="st">&quot;Add bowl implementation.&quot;</span>)</span></code></pre></div>
<p>This branch can be pushed to the remote as usual. Only when merging
we specify the message to be included in the changelog, again with a
bullet.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
You might be used to doing the merges on a remote (e.g. GitHub pull
requests) but here we demonstrate a local merge commit.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_branch_checkout</span>(<span class="st">&quot;main&quot;</span>)</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_merge</span>(<span class="st">&quot;f-bowl&quot;</span>, <span class="at">commit =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="do">## Merge was not committed due to merge conflict(s). Please fix and run git_commit() or git_merge_abort()</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>gert<span class="sc">::</span><span class="fu">git_commit</span>(<span class="st">&quot;- New bowl_of_tea() function makes it easy to drink a bowl of tea.&quot;</span>)</span></code></pre></div>
<p>The same strategy can be used when merging a pull/merge/… request on
GitHub, GitLab, …: use bullet points in the merge commit message to
indicate the items to include in <code>NEWS.md</code>.</p>
<p>Now that we have added bowl support to our package, it is time to
bump the version again.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>fledge<span class="sc">::</span><span class="fu">bump_version</span>()</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="do">## → Scraping 2 commit messages.</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="do">## ✔ Found 1 NEWS-worthy entries.</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="do">## ── Updating NEWS ──</span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a><span class="do">## → Adding new entries to &#39;NEWS.md&#39;.</span></span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a><span class="do">## ── Update Version ──</span></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a><span class="do">## ✔ Package version bumped to 0.0.0.9002.</span></span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a><span class="do">## → Adding header to &#39;NEWS.md&#39;.</span></span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a><span class="do">## → Committing changes.</span></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a><span class="do">## ── Tagging Version ──</span></span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a><span class="do">## → Creating tag v0.0.0.9002 with tag message derived from &#39;NEWS.md&#39;.</span></span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a><span class="do">## • Edit &#39;NEWS.md&#39;</span></span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a><span class="do">## ! Call `fledge::finalize_version(push = TRUE)`.</span></span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a><span class="do">## NULL</span></span>
<span id="cb29-21"><a href="#cb29-21" tabindex="-1"></a>news <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;NEWS.md&quot;</span>)</span>
<span id="cb29-22"><a href="#cb29-22" tabindex="-1"></a><span class="fu">writeLines</span>(news)</span>
<span id="cb29-23"><a href="#cb29-23" tabindex="-1"></a><span class="do">## &lt;!-- NEWS.md is maintained by https://cynkra.github.io/fledge, do not edit --&gt;</span></span>
<span id="cb29-24"><a href="#cb29-24" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-25"><a href="#cb29-25" tabindex="-1"></a><span class="do">## # tea 0.0.0.9002 (2024-02-18)</span></span>
<span id="cb29-26"><a href="#cb29-26" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-27"><a href="#cb29-27" tabindex="-1"></a><span class="do">## - New bowl_of_tea() function makes it easy to drink a bowl of tea.</span></span>
<span id="cb29-28"><a href="#cb29-28" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-29"><a href="#cb29-29" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-30"><a href="#cb29-30" tabindex="-1"></a><span class="do">## # tea 0.0.0.9001 (2024-02-18)</span></span>
<span id="cb29-31"><a href="#cb29-31" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-32"><a href="#cb29-32" tabindex="-1"></a><span class="do">## - Add tests for cup of tea.</span></span>
<span id="cb29-33"><a href="#cb29-33" tabindex="-1"></a><span class="do">## - New cup_of_tea() function makes it easy to drink a cup of tea.</span></span>
<span id="cb29-34"><a href="#cb29-34" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-35"><a href="#cb29-35" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-36"><a href="#cb29-36" tabindex="-1"></a><span class="do">## # tea (development version)</span></span>
<span id="cb29-37"><a href="#cb29-37" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-38"><a href="#cb29-38" tabindex="-1"></a><span class="do">## * Added a `NEWS.md` file to track changes to the package.</span></span>
<span id="cb29-39"><a href="#cb29-39" tabindex="-1"></a>fledge<span class="sc">::</span><span class="fu">finalize_version</span>(<span class="at">push =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-40"><a href="#cb29-40" tabindex="-1"></a><span class="do">## → Resetting to previous commit.</span></span>
<span id="cb29-41"><a href="#cb29-41" tabindex="-1"></a><span class="do">## → Committing changes.</span></span>
<span id="cb29-42"><a href="#cb29-42" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-43"><a href="#cb29-43" tabindex="-1"></a><span class="do">## ── Tagging Version ──</span></span>
<span id="cb29-44"><a href="#cb29-44" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb29-45"><a href="#cb29-45" tabindex="-1"></a><span class="do">## ℹ Tag v0.0.0.9002 exists and points to the current commit.</span></span>
<span id="cb29-46"><a href="#cb29-46" tabindex="-1"></a><span class="do">## → Force-pushing tag v0.0.0.9002.</span></span>
<span id="cb29-47"><a href="#cb29-47" tabindex="-1"></a><span class="do">## → Pushing main.</span></span></code></pre></div>
<p>It seems we do not even need to amend the <code>NEWS.md</code> by
hand this time as we made no typo!</p>
</div>
</div>
<div id="prepare-for-release" class="section level2">
<h2>Prepare for release</h2>
<p>After multiple cycles of development, review and testing, we decide
that our package is ready for release to CRAN. This is where {fledge}
simplifies the release process by making use of the all the commit
messages that we provided earlier.</p>
<p>A difference between publishing on CRAN and publishing on GitHub is
that there’s an external system controlling your publication on CRAN so
your package might need some tweaks between the first release candidate
and what version you end up publishing on CRAN.</p>
<div id="bump-version-for-release" class="section level3">
<h3>Bump version for release</h3>
<p>We wish to release this package as a patch and so we use
<code>fledge::bump_version()</code> with the “patch” argument. Other
values for the arguments are “dev” (default), “minor” and “major”.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>fledge<span class="sc">::</span><span class="fu">bump_version</span>(<span class="st">&quot;patch&quot;</span>)</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="do">## → Scraping 1 commit messages.</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="do">## ✔ Found 1 NEWS-worthy entries.</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="do">## ── Updating NEWS ──</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="do">## → Adding new entries to &#39;NEWS.md&#39;.</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="do">## ── Update Version ──</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a><span class="do">## ✔ Package version bumped to 0.0.1.</span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="do">## → Adding header to &#39;NEWS.md&#39;.</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a><span class="do">## → Committing changes.</span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a><span class="do">## ℹ Preparing package for release (CRAN or otherwise).</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a><span class="do">## • Edit &#39;NEWS.md&#39;</span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a><span class="do">## ! Convert the change log in &#39;NEWS.md&#39; to release notes.</span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a><span class="do">## ! After CRAN release, call `fledge::tag_version()` and</span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a><span class="do">## `fledge::bump_version()` to re-enter development mode</span></span></code></pre></div>
<p>This updates the version of our package to 0.0.1.</p>
</div>
<div id="generate-release-notes" class="section level3">
<h3>Generate release notes</h3>
<p>We review the <code>NEWS.md</code> that were generated by
{fledge}:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>news <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;NEWS.md&quot;</span>)</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="fu">cat</span>(news, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="do">## &lt;!-- NEWS.md is maintained by https://cynkra.github.io/fledge, do not edit --&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="do">## # tea 0.0.1 (2024-02-18)</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="do">## - Same as previous version.</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="do">## # tea 0.0.0.9002 (2024-02-18)</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="do">## - New bowl_of_tea() function makes it easy to drink a bowl of tea.</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a><span class="do">## # tea 0.0.0.9001 (2024-02-18)</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a><span class="do">## - Add tests for cup of tea.</span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="do">## - New cup_of_tea() function makes it easy to drink a cup of tea.</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a><span class="do">## # tea (development version)</span></span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a><span class="do">## * Added a `NEWS.md` file to track changes to the package.</span></span></code></pre></div>
<p>Some of the intermediate commit messages are not relevant in the
release notes for this release. We need to edit <code>NEWS.md</code> to
convert the changelog to meaningful release notes. E.g. in real life we
might <a href="https://style.tidyverse.org/news.html#organisation-3">re-organize
bullets</a>.</p>
<div class="alert alert-warning">
<p>Unlike with development versions, we commit the changes to
<code>NEWS.md</code> manually, not with a fledge function.</p>
</div>
<p>The package is now ready to be released to CRAN. I prefer
<code>devtools::use_release_issue()</code> to create a checklist of
things to do before release, and <code>devtools::submit_cran()</code> to
submit. The <code>devtools::release()</code> function is a more verbose
alternative.</p>
</div>
</div>
<div id="after-release" class="section level2">
<h2>After release</h2>
<p>Some time passed and our {tea} package was accepted on CRAN. At this
stage, {fledge} can help to tag the released version and create a new
version for development.</p>
<div id="tag-version" class="section level3">
<h3>Tag version</h3>
<p>It is now the time to tag the released version using the
<code>fledge::tag_version()</code> function.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>fledge<span class="sc">::</span><span class="fu">tag_version</span>()</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="do">## ── Tagging Version ──</span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="do">## → Creating tag v0.0.1 with tag message derived from &#39;NEWS.md&#39;.</span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="fu">show_tags</span>(remote_url)</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="do">## # A tibble: 2 × 2</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a><span class="do">##   name        ref                  </span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a><span class="do">##   &lt;chr&gt;       &lt;chr&gt;                </span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a><span class="do">## 1 v0.0.0.9001 refs/tags/v0.0.0.9001</span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a><span class="do">## 2 v0.0.0.9002 refs/tags/v0.0.0.9002</span></span></code></pre></div>
<p>It is advised to push to remote, with <code>git push --tags</code>
from the command line, or your favorite Git client.</p>
</div>
<div id="create-github-release" class="section level3">
<h3>Create GitHub release</h3>
<p>If your package is hosted on GitHub,
<code>usethis::use_github_release()</code> creates a draft GitHub
release from the contents already in <code>NEWS.md</code>. You need to
submit the draft release from the GitHub release page.</p>
</div>
<div id="restart-development" class="section level3">
<h3>Restart development</h3>
<p>We will now make the package ready for future development. The
<code>fledge::bump_version()</code> takes care of it.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>fledge<span class="sc">::</span><span class="fu">bump_version</span>()</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="do">## → Scraping 1 commit messages.</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="do">## ✔ Found 1 NEWS-worthy entries.</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="do">## ── Updating NEWS ──</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="do">## → Adding new entries to &#39;NEWS.md&#39;.</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a><span class="do">## ── Update Version ──</span></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="do">## ✔ Package version bumped to 0.0.1.9000.</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a><span class="do">## → Adding header to &#39;NEWS.md&#39;.</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a><span class="do">## → Committing changes.</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a><span class="do">## ── Tagging Version ──</span></span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a><span class="do">## → Creating tag v0.0.1.9000 with tag message derived from &#39;NEWS.md&#39;.</span></span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a><span class="do">## • Edit &#39;NEWS.md&#39;</span></span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a><span class="do">## ! Call `fledge::finalize_version(push = TRUE)`.</span></span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a><span class="do">## NULL</span></span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a>news <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;NEWS.md&quot;</span>)</span></code></pre></div>
<p>Push to remote, add features with relevant commits (after mergining a
branch or not), <code>bump_version()</code>, etc. Happy development, and
happy smooth filling of the changelog!</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="fu">unlink</span>(parent_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Note that we really need a merge commit here; the
default is to fast-forward which doesn’t give us the opportunity to
insert the message intended for the changelog. Earlier, we set the
<code>merge.ff</code> config option to <code>&quot;false&quot;</code> to achieve
this.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
